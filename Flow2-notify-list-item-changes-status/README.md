# DSR Step 2: send approvals when status of request is changed to 'Approved'

This is the second of two Power Automate Flows that are used by the Mercy Corps' Data Protection and Privacy team (DPP) to handle data subject requests. This flow is triggered when the Data Subject Request form owner has reviewed a new request (generated by DSR Step 1) in the specified SharePoint list and changed the value of the **Status** column from `New` to `Approved`. This flow completes the following actions:

1. sends an approval via email to a specified system owner (currently hard-coded into the flow). The approval contains the data subject name, request, and three options for completing the request (which you could adjust or add as needed):
    - The data subject was not found in the system.
    - The data subject was found and deleted from the system.
    - The data subject was found in the system but was not deleted. This can be due to legal obligations to hold the data for a specified period of time, etc.
2. sends the same approval notification information via a Teams chat.

Once the system owner has selected the appropriate compliance option, the flow:

3. Updates the relevant Sharepoint list item **Status** field to `In progress`, which is needed to keep the flow from triggering repeatedly.
4. Updates the relevant Sharepoint list item with the compliance option selected by the system owner. This will appear in the column of the list assigned to that system owner.

An overview of the assets used is below.

![Screenshot of assets used](images/Flow2_overview.png)

In this flow, I'm using a "parallel branch" to add a second approver. To add more approvers you simply need to add a parallel branch for each one. Each parallel branch contains a **Start and wait for an approval** action in which the approval is configured. Under this, each branch also contains a **Switch case** containing an **Update Sharepoint list item** action. This connects the action taken by the approver (e.g. clicking "Subject not found in system") to the list item in Sharepoint (e.g. updates the appropriate column with "Subject not found in system"). I have one case for each option in the approval and, when expanded, the Switch cases look like this:

![Screenshot detail of the Switch case](images/Flow2_switchcase.png)

Together with the other flow in this repo this flow allows us to send approvals to various system holders across our organization and track the compliance of each system owner with the request. If we are audited, our flow provides detailed data concerning all actions taken to comply with the request.

### Helpful resources
Although this flow comes packaged and ready to be imported, you may want to customize it. I found the following resources helpful when I was creating it.

- MS Docs has a good page on [Customizing Approval Requests](https://docs.microsoft.com/en-us/power-automate/approvals-howto), which includes a way to change the options/buttons in an Approval.
- As mentioned above, you can add more "[parallel branches](https://docs.microsoft.com/en-us/power-automate/parallel-modern-approvals)" to add more approvers.
- To understand Switch cases, [see MS documentation on conditionals here](https://learn.microsoft.com/en-us/power-automate/desktop-flows/use-conditionals).

## Features
This flow uses the following concepts:

* Modification of a SharePoint list item
* Conditions
* Sending approvals
* Parallel branches

## Prerequisites
This flow requires a [List in SharePoint](https://support.microsoft.com/en-us/office/introduction-to-lists-0a1c3ace-def0-44af-b225-cfa8d92c52d7). This example uses the following List fields/ column headers: Name, physical address, contact, Citizenship, request type, status (items created with this flow are marked `New`), and various columns for systems that need to be checked for the request. This flow in this repo assumes two columns (labeled "System 1" and "System 2"), but you can add as many as you need.

## Installation
* [Download](Flow-file/DSR_Step2_approval_list_item_status_update.zip) the `.zip` file from the `Flow-file` folder by clicking on "View raw" or the "Download" button. <!-- Test download and import -->
* Browse to your [Power Automate](https://flow.microsoft.com/manage/environments) and select the environment where you wish to import the sample
* From the toolbar, select **Import**, then **Import package**.
* In the **Import package** page, select **Upload** and choose the `.zip` file containing the sample flow.
* You will need to change the relevant resources to connect with your accountduring the import. To do this, look for the `Select during import` link under the "Import Setup" column. Click this link, then look for your resources and connections to appear in the pop-up window. Select the appropriate resources then click save. See screenshot below.

> ![Screenshot of assets used](images/Flow_import_resourcechanges.png)

* Once you've updated the required resources select **Import**
* Once the sample Flow is installed, forms, lists, and staff. **were list the fields to change**?
* You may need to [turn the flow on](https://learn.microsoft.com/en-us/power-automate/disable-flow).

For further help importing Flows, [see this blog post from Microsoft](https://powerautomate.microsoft.com/en-us/blog/import-export-bap-packages/).

## Help & Feedback
If you are a Mercy Corps staff member and need help duplicating this flow for another use case, reach out to shroberts@mercycorps.org for assistance. <!-- add path when ready --> Anyone can [create a new issue](https://github.com/pnp/powerautomate-samples/issues/new?assignees=&labels=Needs%3A+Triage+%3Amag%3A%2Ctype%3Abug-suspected&template=bug-report.yml&sample=YOURSAMPLENAME&authors=@YOURGITHUBUSERNAME&title=YOURSAMPLENAME%20-%20) in this repository.

This repository is maintained by the Data Protection & Privacy team at Mercy Corps. You can submit updates or additions to this material via a Github pull request ([read about pull requests here](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests)) or by contacting us at dataprotection@mercycorp.org.

## For more information
- [Create your first flow](https://docs.microsoft.com/en-us/power-automate/getting-started#create-your-first-flow)
- [Microsoft Power Automate documentation](https://docs.microsoft.com/en-us/power-automate/)

## Disclaimer
This code is provided *as is* without any warranty of any kind, either express or implied, including any implied warranties of fitness for a particular purpose, merchantability, or non-infringement.
